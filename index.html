<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Jsmap by aqicn</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Jsmap</h1>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/aqicn/jsmap/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/aqicn/jsmap/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/aqicn/jsmap" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">

          <script src='https://rawgit.com/aqicn/jsmap/master/lib/bundle-jsmap-loader.js'></script>


          <canvas id='canvas'></canvas>
          <div id='subtitle'></div>

          <script type="text/javascript">

          var canvas = document.getElementById("canvas");
          var subtitle = document.getElementById("subtitle");

          jsmap.load({fps:30}).then(function(model){

            model.frames.subscribe(function(frame){

              window.requestAnimationFrame(function(){
                plot(frame,model,canvas);
                subtitle.innerHTML = frame.datetime;
              });

            });
          });



          function plot(frame, model, canvas) 
          {
            var width = frame.size.width;
            var height = frame.size.height;

            canvas.width = width;
            canvas.height = height;
            var ctx = canvas.getContext('2d');
            var imageData = ctx.createImageData(width, height);

            var pout = 0, pin = 0;
            var colors = model.lut.colors;
            var matrix = frame.matrix;
            for (var y = 0; y < height; y+=1) {
              for (var x = 0; x < width; x+=1, pin+=1) {
                var color = colors[matrix[pin]];
                imageData.data[pout++] = (color>>16)&0xff;
                imageData.data[pout++] = (color>>8)&0xff;
                imageData.data[pout++] = color&0xff;
                imageData.data[pout++] = 255;
              }
            }
            ctx.putImageData(imageData, 0, 0);


          }


          </script>          
          
        </section>

        <footer>
          Jsmap is maintained by <a href="https://github.com/aqicn">aqicn</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
